<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div th:fragment="line-chart(chartData)">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script th:inline="javascript" type="text/javascript">
        /*<![CDATA[*/
        var my_data = /*[[${chartData}]]*/ ['error'];
        /*]]>*/
        var refined_data=[];
        refined_data[0]=['Zeit','Besucher'];
        var array_index=1;
        var current_datapoints=0;
        for(var i=0;i<my_data.length;i++){
            //String(my_data[i].datapoint_hour).padStart(2, '0')+':'+String(my_data[i].datapoint_minute).padStart(2, '0')
            var time=String(my_data[i].datapoint_hour).padStart(2, '0')+':'
            if(my_data[i].datapoint_minute<30)time+='00';
            else time+='30';
            //console.log('time: '+time);console.log('array index: '+array_index);console.log('current datapoint: '+current_datapoints);console.log(refined_data)
            if(time!=refined_data[array_index-1][0]){
                if(current_datapoints>0){
                    refined_data[array_index-1][1]=Math.floor((refined_data[array_index-1][1])/current_datapoints);
                    current_datapoints=0;
                }
                refined_data[array_index]=[time,my_data[i].datapoint_act];
                array_index++;
                current_datapoints++;
            }else{
                refined_data[array_index-1][1]+=my_data[i].datapoint_act;
                current_datapoints++;
            }
        }
        refined_data[array_index-1][1]=Math.floor((refined_data[array_index-1][1])/current_datapoints);
        //console.log(refined_data);

        google.charts.load('current', {
            'packages': ['corechart']
        });
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
            var data = google.visualization.arrayToDataTable(refined_data);

            var options = {
                isStacked: false,
                title: 'Company Performance',
                vAxis: {
                    minValue: 0,
                    maxValue:160
                },
                series: {
                    1: {
                        areaOpacity: 0
                    }
                },
                legend: { position: 'none' }
            };

            var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
            chart.draw(data, options);
        }
    </script>
    <div id="chart_div" style="width: 900px; height: 500px"></div>
</div>
</body>
</html>