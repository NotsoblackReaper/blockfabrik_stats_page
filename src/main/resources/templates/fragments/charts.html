<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<th:block th:fragment="chart-base()">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {
            'packages': ['corechart']
        });

        function refine_data(raw_data){
            var refined_data=[];
            refined_data[0]=['Zeit','Besucher'];
            for(var i=0,array_index=1,current_datapoints=0;i<raw_data.length;i++){
                var time=String(raw_data[i].datapoint_hour).padStart(2, '0')+':'
                if(raw_data[i].datapoint_minute<30)time+='00';
                else time+='30';
                if(time!=refined_data[array_index-1][0]){
                    if(current_datapoints>0){
                        refined_data[array_index-1][1]=Math.floor((refined_data[array_index-1][1])/current_datapoints);
                        current_datapoints=0;
                    }
                    refined_data[array_index]=[time,raw_data[i].datapoint_act];
                    array_index++;
                    current_datapoints++;
                }else{
                    refined_data[array_index-1][1]+=raw_data[i].datapoint_act;
                    current_datapoints++;
                }
            }
            refined_data[array_index-1][1]=Math.floor((refined_data[array_index-1][1])/current_datapoints);
            return refined_data;
        }
    </script>
</th:block>

<th:block th:fragment="simple-bar-chart(chartData,dayName,divName,methodName)">
    <script th:inline="javascript" type="text/javascript">
        function [(${methodName})]()
        {
                /*<![CDATA[*/
                var raw_data = /*[[${chartData}]]*/ ['error'];
                var dayName = /*[[${dayName}]]*/ 'error';
                var divName = /*[[${divName}]]*/ 'error';
                /*]]>*/
                if (raw_data.length > 0) {
                    var refined_data = refine_data(raw_data);

                var data = google.visualization.arrayToDataTable(refined_data);

                var options = {
                    isStacked: false,
                    title: 'Besucher ' + dayName,
                    vAxis: {
                        minValue: 0,
                        maxValue: 160
                    },
                    series: {
                        1: {
                            areaOpacity: 0
                        }
                    },
                    legend: {position: 'none'},
                    backgroundColor: {
                        fill: 'transparent',
                    },
                    chartArea: {
                        width: '85%',
                        height: '80%',
                        backgroundColor: {},
                    },
                    bar: {
                        groupWidth: "100%"
                    }
                };

                var chart = new google.visualization.ColumnChart(document.getElementById(divName));
                chart.draw(data, options);
            }
        }

        google.charts.setOnLoadCallback([(${methodName})]);
    </script>
</th:block>
</body>
</html>